#!/usr/bin/env bash

# Source error handling, leave this in place
set -xe

# Source CustomPIOS common.sh
source /common.sh
install_cleanup_trap

pushd /home/${BASE_USER}
echo_green "Installing DFU-util build dependencies"
apt-get -y install libusb-1.0-0-dev autoconf pandoc automake
echo_green "Cloning and building DFU-util"
 # Fallback to GitLab mirror if the official SourceForge is down... which it often is..
git clone git://git.code.sf.net/p/dfu-util/dfu-util || git clone https://gitlab.com/dfu-util/dfu-util.git
pushd /home/${BASE_USER}/dfu-util
./autogen.sh
./configure
make install
echo_green "Removing DFU-util build dependencies"
apt-get -y purge pandoc
popd
popd
